<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuizaTeca - Sistema de Biblioteca</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f3f4f6;
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--white);
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: inline-block;
        }

        .content {
            padding: 30px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-form,
        .register-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light);
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-block {
            width: 100%;
            margin-top: 10px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .menu-card {
            background: var(--white);
            border: 2px solid var(--light);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        }

        .menu-card .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .menu-card h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .menu-card p {
            color: #6b7280;
            font-size: 0.9em;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: 10px;
            overflow: hidden;
        }

        thead {
            background: var(--primary);
            color: var(--white);
        }

        th,
        td {
            padding: 15px;
            text-align: left;
        }

        tbody tr {
            border-bottom: 1px solid var(--light);
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: var(--light);
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--dark);
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success);
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 8px 15px;
            font-size: 0.9em;
            margin-right: 5px;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .link-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            padding: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìö LuizaTeca</h1>
            <p>Sistema de Gerenciamento de Biblioteca</p>
            <div id="userInfo" class="user-info" style="display: none;">
                <span id="userName"></span> | <span id="userType"></span>
            </div>
        </div>

        <div class="content">
            <!-- Tela de Login -->
            <div id="loginScreen" class="screen active">
                <form id="loginForm" class="login-form">
                    <h2 class="text-center" style="margin-bottom: 30px;">üîê Login</h2>
                    <div class="form-group">
                        <label>üìß Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>üîí Senha</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Entrar</button>
                    <div class="text-center mt-20">
                        <p>N√£o tem conta? <button type="button" class="link-btn"
                                onclick="showScreen('registerScreen')">Cadastre-se</button></p>
                    </div>
                </form>
            </div>

            <!-- Tela de Cadastro -->
            <div id="registerScreen" class="screen">
                <form id="registerForm" class="register-form">
                    <h2 class="text-center" style="margin-bottom: 30px;">‚úçÔ∏è Cadastro</h2>
                    <div class="form-group">
                        <label>üë§ Nome</label>
                        <input type="text" id="regNome" required>
                    </div>
                    <div class="form-group">
                        <label>üìß Email</label>
                        <input type="email" id="regEmail" required>
                    </div>
                    <div class="form-group">
                        <label>üîí Senha</label>
                        <input type="password" id="regSenha" required>
                    </div>
                    <div class="form-group">
                        <label>üé≠ Tipo de Conta</label>
                        <select id="regTipo">
                            <option value="usuario">üë§ Usu√°rio</option>
                            <option value="bibliotecario">üë®‚Äçüíº Bibliotec√°rio</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Cadastrar</button>
                    <button type="button" class="btn btn-secondary btn-block"
                        onclick="showScreen('loginScreen')">Voltar</button>
                </form>
            </div>

            <!-- Menu Principal -->
            <div id="menuScreen" class="screen">
                <h2 style="margin-bottom: 20px;">Menu Principal</h2>
                <div class="menu-grid" id="menuGrid"></div>
                <div class="text-center mt-20">
                    <button class="btn btn-danger" onclick="logout()">üö™ Sair</button>
                </div>
            </div>

            <!-- Tela de Livros -->
            <div id="livrosScreen" class="screen">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>üìö Acervo de Livros</h2>
                    <div>
                        <button class="btn btn-success" onclick="showModal('addLivroModal')" id="btnAddLivro"
                            style="display: none;">‚ûï Adicionar Livro</button>
                        <button class="btn btn-secondary" onclick="showScreen('menuScreen')">‚Ü©Ô∏è Voltar</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="livrosTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√≠tulo</th>
                                <th>Autor</th>
                                <th>G√™nero</th>
                                <th>Localiza√ß√£o</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Tela de Alugu√©is -->
            <div id="alugueisScreen" class="screen">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>üìã Empr√©stimos</h2>
                    <div>
                        <button class="btn btn-success" onclick="showModal('addAluguelModal')" id="btnAddAluguel"
                            style="display: none;">‚ûï Novo Aluguel</button>
                        <button class="btn btn-secondary" onclick="showScreen('menuScreen')">‚Ü©Ô∏è Voltar</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="alugueisTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usu√°rio</th>
                                <th>Livro</th>
                                <th>Data Aluguel</th>
                                <th>Prazo Devolu√ß√£o</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- Tela de Usu√°rios -->
            <div id="usuariosScreen" class="screen">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>üë• Gerenciar Usu√°rios</h2>
                    <button class="btn btn-secondary" onclick="showScreen('menuScreen')">‚Ü©Ô∏è Voltar</button>
                </div>
                <div class="table-container">
                    <table id="usuariosTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Tipo</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Livro -->
    <div id="addLivroModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Cadastrar Novo Livro</h2>
            </div>
            <form id="addLivroForm">
                <div class="form-group">
                    <label>üìñ T√≠tulo</label>
                    <input type="text" id="livroTitulo" required>
                </div>
                <div class="form-group">
                    <label>‚úçÔ∏è Autor</label>
                    <input type="text" id="livroAutor" required>
                </div>
                <div class="form-group">
                    <label>üìÖ Ano de Lan√ßamento</label>
                    <input type="number" id="livroAno" required>
                </div>
                <div class="form-group">
                    <label>üé≠ G√™nero</label>
                    <input type="text" id="livroGenero" required>
                </div>
                <div class="form-group">
                    <label>üî¢ ISBN (opcional)</label>
                    <input type="text" id="livroIsbn">
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-success">Cadastrar</button>
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('addLivroModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Adicionar Aluguel -->
    <div id="addAluguelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Registrar Novo Aluguel</h2>
            </div>
            <form id="addAluguelForm">
                <div class="form-group">
                    <label>üìö Livro</label>
                    <select id="aluguelLivro" required></select>
                </div>
                <div class="form-group">
                    <label>üë§ Usu√°rio</label>
                    <select id="aluguelUsuario" required></select>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-success">Registrar</button>
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('addAluguelModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Usu√°rio -->
    <div id="editUsuarioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Editar Usu√°rio</h2>
            </div>
            <form id="editUsuarioForm">
                <input type="hidden" id="editUsuarioId">
                <div class="form-group">
                    <label>üë§ Nome</label>
                    <input type="text" id="editUsuarioNome" required>
                </div>
                <div class="form-group">
                    <label>üìß Email</label>
                    <input type="email" id="editUsuarioEmail" required>
                </div>
                <div class="form-group">
                    <label>üé≠ Tipo</label>
                    <select id="editUsuarioTipo">
                        <option value="usuario">üë§ Usu√°rio</option>
                        <option value="bibliotecario">üë®‚Äçüíº Bibliotec√°rio</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-success">Salvar</button>
                    <button type="button" class="btn btn-secondary"
                        onclick="closeModal('editUsuarioModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:3000/api';
        let token = null;
        let currentUser = null;

        // Fun√ß√µes de Navega√ß√£o
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;

            const content = document.querySelector('.content');
            content.insertBefore(alertDiv, content.firstChild);

            setTimeout(() => alertDiv.remove(), 3000);
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const senha = document.getElementById('loginPassword').value;

            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, senha })
                });

                const data = await res.json();
                if (res.ok) {
                    token = data.token;
                    currentUser = data.usuario;
                    updateUserInfo();
                    loadMenu();
                    showScreen('menuScreen');
                    showAlert('Login realizado com sucesso!');
                } else {
                    showAlert(data.error, 'danger');
                }
            } catch (error) {
                showAlert('Erro ao conectar com o servidor', 'danger');
            }
        });

        // Registro
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nome = document.getElementById('regNome').value;
            const email = document.getElementById('regEmail').value;
            const senha = document.getElementById('regSenha').value;
            const tipo = document.getElementById('regTipo').value;

            try {
                const res = await fetch(`${API_URL}/auth/registrar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nome, email, senha, tipo })
                });

                const data = await res.json();
                if (res.ok) {
                    token = data.token;
                    currentUser = data.usuario;
                    updateUserInfo();
                    loadMenu();
                    showScreen('menuScreen');
                    showAlert('Cadastro realizado com sucesso!');
                } else {
                    showAlert(data.error, 'danger');
                }
            } catch (error) {
                showAlert('Erro ao conectar com o servidor', 'danger');
            }
        });

        function updateUserInfo() {
            document.getElementById('userName').textContent = currentUser.nome;
            document.getElementById('userType').textContent = currentUser.tipo === 'bibliotecario' ? 'üë®‚Äçüíº Bibliotec√°rio' : 'üë§ Usu√°rio';
            document.getElementById('userInfo').style.display = 'inline-block';
        }

        function loadMenu() {
            const menuGrid = document.getElementById('menuGrid');
            menuGrid.innerHTML = '';

            const menus = [
                { icon: 'üìö', title: 'Consultar Livros', desc: 'Ver acervo completo', screen: 'livrosScreen', action: loadLivros }
            ];

            if (currentUser.tipo === 'bibliotecario') {
                menus.push(
                    { icon: 'üìã', title: 'Empr√©stimos', desc: 'Gerenciar alugu√©is', screen: 'alugueisScreen', action: loadAlugueis },
                    { icon: 'üë•', title: 'Usu√°rios', desc: 'Gerenciar usu√°rios', screen: 'usuariosScreen', action: loadUsuarios }
                );
                document.getElementById('btnAddLivro').style.display = 'inline-block';
                document.getElementById('btnAddAluguel').style.display = 'inline-block';
            } else {
                menus.push(
                    { icon: 'üìñ', title: 'Meus Empr√©stimos', desc: 'Ver meus livros', screen: 'alugueisScreen', action: loadMeusAlugueis }
                );
            }

            menus.forEach(menu => {
                const card = document.createElement('div');
                card.className = 'menu-card';
                card.innerHTML = `
                    <div class="icon">${menu.icon}</div>
                    <h3>${menu.title}</h3>
                    <p>${menu.desc}</p>
                `;
                card.onclick = () => {
                    menu.action();
                    showScreen(menu.screen);
                };
                menuGrid.appendChild(card);
            });
        }

        async function apiCall(endpoint, options = {}) {
            const headers = { 'Content-Type': 'application/json' };
            if (token) headers.Authorization = `Bearer ${token}`;

            const res = await fetch(`${API_URL}${endpoint}`, { ...options, headers });
            return res.json();
        }

        // Livros
        async function loadLivros() {
            const data = await apiCall('/livros');
            const tbody = document.querySelector('#livrosTable tbody');
            tbody.innerHTML = '';

            data.forEach(livro => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${livro.id}</td>
                    <td>${livro.titulo}</td>
                    <td>${livro.autor}</td>
                    <td>${livro.genero || 'N/A'}</td>
                    <td>${livro.corredor}-${livro.prateleira}</td>
                    <td><span class="badge ${livro.status === 'disponivel' ? 'badge-success' : 'badge-danger'}">
                        ${livro.status === 'disponivel' ? 'üü¢ Dispon√≠vel' : 'üî¥ Alugado'}
                    </span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        document.getElementById('addLivroForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const livro = {
                titulo: document.getElementById('livroTitulo').value,
                autor: document.getElementById('livroAutor').value,
                ano_lancamento: parseInt(document.getElementById('livroAno').value),
                genero: document.getElementById('livroGenero').value,
                isbn: document.getElementById('livroIsbn').value || null
            };

            try {
                const data = await apiCall('/livros', {
                    method: 'POST',
                    body: JSON.stringify(livro)
                });

                showAlert('Livro cadastrado com sucesso!');
                closeModal('addLivroModal');
                loadLivros();
                e.target.reset();
            } catch (error) {
                showAlert('Erro ao cadastrar livro', 'danger');
            }
        });

        // Alugu√©is
        async function loadAlugueis() {
            const data = await apiCall('/alugueis/todos');
            const tbody = document.querySelector('#alugueisTable tbody');
            tbody.innerHTML = '';

            data.forEach(aluguel => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${aluguel.id}</td>
                    <td>${aluguel.usuario}</td>
                    <td>${aluguel.titulo}</td>
                    <td>${new Date(aluguel.data_aluguel).toLocaleDateString('pt-BR')}</td>
                    <td>${new Date(aluguel.data_prevista_devolucao).toLocaleDateString('pt-BR')}</td>
                    <td><span class="badge ${aluguel.status === 'ativo' ? 'badge-warning' : 'badge-success'}">
                        ${aluguel.status === 'ativo' ? 'üü° Ativo' : 'üü¢ Devolvido'}
                    </span></td>
                    <td>
                        ${aluguel.status === 'ativo' ?
                        `<button class="btn btn-success action-btn" onclick="devolverLivro(${aluguel.id})">‚Ü©Ô∏è Devolver</button>` :
                        '-'}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function loadMeusAlugueis() {
            const data = await apiCall('/alugueis/meus');
            const tbody = document.querySelector('#alugueisTable tbody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">Voc√™ n√£o tem empr√©stimos</td></tr>';
                return;
            }

            data.forEach(aluguel => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${aluguel.id}</td>
                    <td>${currentUser.nome}</td>
                    <td>${aluguel.titulo}</td>
                    <td>${new Date(aluguel.data_aluguel).toLocaleDateString('pt-BR')}</td>
                    <td>${new Date(aluguel.data_prevista_devolucao).toLocaleDateString('pt-BR')}</td>
                    <td><span class="badge ${aluguel.status === 'ativo' ? 'badge-warning' : 'badge-success'}">
                        ${aluguel.status === 'ativo' ? 'üü° Ativo' : 'üü¢ Devolvido'}
                    </span></td>
                    <td>-</td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function devolverLivro(id) {
            if (!confirm('Confirmar devolu√ß√£o do livro?')) return;

            try {
                await apiCall(`/alugueis/${id}/devolver`, { method: 'PUT' });
                showAlert('Livro devolvido com sucesso!');
                loadAlugueis();
            } catch (error) {
                showAlert('Erro ao devolver livro', 'danger');
            }
        }

        // Preparar modal de aluguel
        async function prepareAluguelModal() {
            const livros = await apiCall('/livros?status=disponivel');
            const usuarios = await apiCall('/usuarios');

            const selectLivro = document.getElementById('aluguelLivro');
            const selectUsuario = document.getElementById('aluguelUsuario');

            selectLivro.innerHTML = '<option value="">Selecione um livro...</option>';
            livros.forEach(livro => {
                selectLivro.innerHTML += `<option value="${livro.id}">${livro.titulo} - ${livro.autor}</option>`;
            });

            selectUsuario.innerHTML = '<option value="">Selecione um usu√°rio...</option>';
            usuarios.forEach(usuario => {
                selectUsuario.innerHTML += `<option value="${usuario.id}">${usuario.nome} (${usuario.email})</option>`;
            });
        }

        document.getElementById('btnAddAluguel').addEventListener('click', prepareAluguelModal);

        document.getElementById('addAluguelForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const aluguel = {
                livro_id: parseInt(document.getElementById('aluguelLivro').value),
                usuario_id: parseInt(document.getElementById('aluguelUsuario').value)
            };

            try {
                await apiCall('/alugueis', {
                    method: 'POST',
                    body: JSON.stringify(aluguel)
                });

                showAlert('Aluguel registrado com sucesso!');
                closeModal('addAluguelModal');
                loadAlugueis();
                e.target.reset();
            } catch (error) {
                showAlert('Erro ao registrar aluguel', 'danger');
            }
        });

        // Usu√°rios
        async function loadUsuarios() {
            const data = await apiCall('/usuarios');
            const tbody = document.querySelector('#usuariosTable tbody');
            tbody.innerHTML = '';

            data.forEach(usuario => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${usuario.id}</td>
                    <td>${usuario.nome}</td>
                    <td>${usuario.email}</td>
                    <td><span class="badge ${usuario.tipo === 'bibliotecario' ? 'badge-warning' : 'badge-success'}">
                        ${usuario.tipo === 'bibliotecario' ? 'üë®‚Äçüíº Bibliotec√°rio' : 'üë§ Usu√°rio'}
                    </span></td>
                    <td>
                        <button class="btn btn-primary action-btn" onclick="editarUsuario(${usuario.id}, '${usuario.nome}', '${usuario.email}', '${usuario.tipo}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-danger action-btn" onclick="excluirUsuario(${usuario.id})">üóëÔ∏è Excluir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function editarUsuario(id, nome, email, tipo) {
            document.getElementById('editUsuarioId').value = id;
            document.getElementById('editUsuarioNome').value = nome;
            document.getElementById('editUsuarioEmail').value = email;
            document.getElementById('editUsuarioTipo').value = tipo;
            showModal('editUsuarioModal');
        }

        document.getElementById('editUsuarioForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('editUsuarioId').value;
            const usuario = {
                nome: document.getElementById('editUsuarioNome').value,
                email: document.getElementById('editUsuarioEmail').value,
                tipo: document.getElementById('editUsuarioTipo').value
            };

            try {
                await apiCall(`/usuarios/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(usuario)
                });

                showAlert('Usu√°rio atualizado com sucesso!');
                closeModal('editUsuarioModal');
                loadUsuarios();
            } catch (error) {
                showAlert('Erro ao atualizar usu√°rio', 'danger');
            }
        });

        async function excluirUsuario(id) {
            if (!confirm('Tem certeza que deseja excluir este usu√°rio? Esta a√ß√£o n√£o pode ser desfeita!')) return;

            try {
                await apiCall(`/usuarios/${id}`, { method: 'DELETE' });
                showAlert('Usu√°rio exclu√≠do com sucesso!');
                loadUsuarios();
            } catch (error) {
                showAlert('Erro ao excluir usu√°rio', 'danger');
            }
        }

        function logout() {
            if (!confirm('Deseja realmente sair?')) return;
            token = null;
            currentUser = null;
            document.getElementById('userInfo').style.display = 'none';
            showScreen('loginScreen');
            showAlert('Logout realizado com sucesso!');
        }
    </script>
</body>

</html>